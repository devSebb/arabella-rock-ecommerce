<div class="container mx-auto px-4 my-10">
  <div class="flex justify-between items-center">
    <h1 class="text-white text-4xl mb-12">Your Cart</h1>
    <%= link_to "Back", :back, class:"text-white text-xl"  %>
  </div>

  <% if @cart.present? && @cart.any? %>
    <div class="space-y-10" data-controller="cart">
      <% total_sum = 0 %>
      <% @cart.each do |product_id, quantity| %>
        <% product = Product.find_by(id: product_id) %>
        <% if product %>
          <div class="flex justify-between items-center p-4 rounded-lg w-full" style="background-color: #27272a; border: 1px solid #fff;">
            <div class="flex items-center space-x-4 w-2/3">
              <%= image_tag product.images.first, alt: product.name, class: "w-10 rounded" if product.images.attached? %>
              <div>
                <h2 class="text-white text-xl font-semibold"><%= product.name %></h2>
                <p class="text-gray-300">$<%= product.price %></p>
              </div>
            </div>
            <div class="flex flex-col items-end space-y-2 w-1/3">
              <%= form_with url: update_quantity_cart_path(product_id), method: :patch, class: "flex items-center space-x-2" do |f| %>
                <%= f.button "-", type: "button", class: "bg-gray-700 text-white w-8 h-8 rounded-full", data: { action: "click->cart#decrementQuantity" } %>
                <%= f.number_field :quantity, id: "quantity-#{product_id}", value: quantity, min: 1, class: "bg-gray-700 text-black w-12 text-center rounded", data: { cart_target: "quantity" } %>
                <%= f.button "+", type: "button", class: "bg-gray-700 text-white w-8 h-8 rounded-full", data: { action: "click->cart#incrementQuantity" } %>
                <%= f.submit "Update", class: "bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600" %>
              <% end %>
              <%= button_to 'Remove', remove_from_cart_path(product_id), method: :delete, class: "text-red-500 hover:text-red-600" %>
            </div>
          </div>
          <% total_sum += product.price * quantity %>
        <% end %>
      <% end %>

      <%# Total Price %>
      <div class="flex justify-between items-center p-4 rounded-lg w-full bg-white text-black">
        <h2 class="text-xl font-semibold">Total Price:</h2>
        <p class="text-xl">$<%= total_sum %></p>
      </div>

      <div class="mt-8">
        <% if user_signed_in? %>
          <%= button_to 'Checkout', orders_path, method: :post, class: "bg-green-800 text-white px-6 py-3 rounded-lg hover:bg-green-600" %>
        <% else %>
          <%= link_to 'Login to Checkout', new_user_session_path, class: "bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600" %>
        <% end %>
      </div>
    </div>
  <% else %>
    <p class="text-white text-xl">Your cart is empty.</p>
  <% end %>
</div>
